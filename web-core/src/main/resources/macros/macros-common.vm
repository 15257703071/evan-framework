
#*
	获取本应用的地址
*#
#macro(getAppServer)
$context_appServer##
#end

#*
	获取本应用的地址
*#
#macro(getCurrentSystemUrl $path)
#if(!$stringUtil.startsWith($path,"/"))
#set($path="/$path")
#end
##$context_appServer$!{context_currentServerPrefix}$path##
$context_appServer$path##
#end

#*
	获取第三方开源前端资源的地址
*#
#macro(getComponentUrl)
$context_refUrl##
#end

#*
	获取本产品(项目)前端资源的地址
*#
#macro(getWebresourcesUrl)
$context_webresourcesUrl##
#end

#*
	获取本应用javascript文件的地址
*#
#macro(getJsPath)
#if(!$common_appJsPath)#set($common_appJsPath="#getAppServer()/scripts")#end
$common_appJsPath##
#end

#*
	获取本应用css文件的地址
*#
#macro(getStylePath)
#if(!$common_appStylePath)#set($common_appStylePath="#getAppServer()/styles")#end
$common_appStylePath##
#end

#*
	获取本应用图片文件的地址
*#
#macro(getImagePath)
#if(!$common_appImagePath)#set($common_appImagePath="#getAppServer()/images")#end
$common_appImagePath##
#end

#*
	获取文件上传服务器地址
*#
#macro(getUploadServer)
#if(!$common_uploadUrl)#set($common_uploadUrl=$appContextTool.getUploadUrl($request))#end	
$common_uploadUrl##
#end

#macro(getUploadFileUrl $filePath)
#if($filePath)
#if(!$stringUtil.startsWith($filePath,"/"))
#set($filePath="/$filePath")
#end
#getUploadServer()$filePath##
#end##
#end

##渲染必填标记
#macro(requiredTag)
<em class="requiredTag">*</em> 
#end

##获取基础数据
#macro(getDictionaryData $parameters)
	#if("$!parameters.data"!="")
		#set($dictionaryData=$!parameters.data)
	#else
		#set($dictionaryData=$dataDictTool.getDataDictionarys($parameters.dictGroup))
	#end
#end

#*
  渲染 select标签
  $parameters {Map}包括
      id {String}select 标签的id,默认等于name
      name  {String} select 标签的name,必须
      firstOption {Array} 为select加上第一个选项 ,数据格式：[value,text]
      dictGroup {String} 渲染数据字典的数据时，数据字典的分组
      data {List<DataDictionary>} 渲染的数据，dictGroup和data必须提供一个
      selectedValue 选择值

   $attributs {String} 附加属性   格式："style='width:100px' class='select'"
*#
#macro(formSelect $parameters $attributs)
	#set($id="$!parameters.id")
	#if("$id"=="")
		#set($id=$parameters.name)
	#end

	#getDictionaryData($parameters)

	<select name="$parameters.name" id="$id" $!attributs>
		##为select加上第一个选项
		#if("$!parameters.firstOption" != "")
			<option value="$!parameters.firstOption.get(0)">$!parameters.firstOption.get(1)</option>
		#else
			<option value="">[请选择]</option>
		#end

		#foreach($option in $dictionaryData)
			#set($selected="")
			#if("$!parameters.selectedValue" == "$option.value")
				#set($selected="selected")
			#end

			<option value="$option.value" $!selected>$option.text</option>
		#end
	</select>
#end

#*
   渲染一组 Radio标签
  $parameters {Map}包括
      name  {String} select 标签的name,必须
      dictGroup {String} 渲染数据字典的数据时，数据字典的分组
      data {List<DataDictionary>} 渲染的数据，dictGroup和data必须提供一个
      selectedValue 选择值
*#
#macro(formRadioList $parameters)
	#set($id="$!parameters.id")
	#if("$id"=="")
		#set($id=$parameters.name)
	#end

	#getDictionaryData($parameters)

	#foreach($o in $dictionaryData)
		#set($selected="")
		#if($parameters.selectedValue)
			#if("$!parameters.selectedValue" == "$o.value")
				#set($selected="checked")
			#end
		#elseif($velocityCount==1)
			#set($selected="checked")
		#end

		<input name="$parameters.name" type="radio" id="${id}_$o.value" value="$o.value" $!selected>
		<label for="${id}_$o.value">#direct($o.text)</label>	
	#end
#end

#*
   渲染一组 Checkbox标签
  $parameters {Map}包括
      name  {String} select 标签的name,必须
      dictGroup {String} 渲染数据字典的数据时，数据字典的分组
      data {List<DataDictionary>} 渲染的数据，dictGroup和data必须提供一个
      selectedValues {Array} 选择值,数组
*#
#macro(formCheckboxList $parameters )
	#set($id="$!parameters.id")
	#if("$id"=="")
		#set($id=$parameters.name)
	#end
	#getDictionaryData($parameters)
	##set($selectedValues=",$!parameters.selectedValue,")
	#set($selectedValues=$!parameters.selectedValues)
	<div id="checkbox_$parameters.name" style="float:left;margin-right:5px;">	
    	#foreach($o in $dictionaryData)
    		#set($selected="")
    		##if( $selectedValues.indexOf(",$o.value,") != "-1")
    			##set($selected="checked")
    		##end
    		#foreach($item in $selectedValues)
    			#if("$!o.value"=="$!item")
    				#set($selected="checked")
    			#end
    		#end
    		
    		<input name="$parameters.name" type="checkbox" id="${id}_$o.value" value="$o.value" $!selected>
    		<label for="${id}_$o.value">#direct($o.text)</label>
    		##if($o.color) style="color:$o.color" #end
    	#end
	</div>
#end

##根据基础数据的group和value获取数据字典名称
#macro(getDictionaryName $group $value)#direct($!dataDictTool.getDictName($request,$group,"$!value"))#end

##根据地区代码获取地区名称
#macro(getRegionName $regionCode)$!regionTool.getRegionName($request,"$!regionCode")#end

#* 渲染 kindeditor html编辑器
   $parameters {Map}包括
      id {String}textarea 标签的id,默认等于name
      name  {String} textarea 标签的name,必须
      value {String} 选择值
	  width  {String} 选择值 默认630
      height {String} 选择值 默认300
	  style {String} 样式  simple

   $attributs {String} 附加属性   格式："style='width:100px' class='select'"
*#
#macro(kindeditor $parameters $attributs)
	#set($id="$!parameters.id")
	#if("$id"=="")
		#set($id=$parameters.name)
	#end

	#set($width="$!parameters.width")
	#if("$width"=="")
		#set($width="620")
	#end

	#set($height="$!parameters.height")
	#if("$height"=="")
		#set($height="300")
	#end

	#if("$parameters.style"=="simple")
		#set($items="['fontname', 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
						'removeformat', '|', 'justifyleft', 'justifycenter', 'justifyright', 'insertorderedlist',
						'insertunorderedlist']")
	#elseif("$parameters.style"=="title")
		#set($items="['forecolor', 'bold', 'italic', 'underline']")
		#set($height="20")
	#else
		#set($items=$!parameters.items)
	#end
	

	<textarea id="$id" name="$parameters.name" style="height:${height}px;display:none;" $!attributs>$!parameters.value</textarea>
    <script type="text/javascript">
	 	var kindEditor_$id;
		KindEditor.ready(function(K) {
			kindEditor_$id = K.create('textarea[name="$parameters.name"]', {
				allowFileManager : false,
				allowMediaUpload : false,
				allowFlashUpload : false,
				imageUploadAction : "#getCurrentSystemUrl('kindeditor-image-upload')",
				accessoryUploadAction : "#getCurrentSystemUrl('kindeditor-accessory-upload')",
				#if("$!items"!="")
			 		items:$!items,
			 	#end
				width:'${width}px',
				height:'${height}px'			
			});
			
		});
		 
		 #*KE.show({
    	     id : '$id',
    	  	 resizeMode : 1,
    	   	 allowFileManager : true,
    	   	 uploadesize:3,
			 #if("$!items"!="")
			 items:$!items,
			 #end
    	   	 width:'${width}px'
    	 });*#
	</script>
#end

#*
	分页工具条
	$paramters{Map}
		$id{String} 多个分页bar是用于区分
    	$page{Page} 必须 对象
		$queryFormId{String} 查询参数所在的form
    	$submitUrl{String} 可选 提交的链接 默认本链接 
		$showPageCount(integer)
		$canSetPagesize(boolean) 是否可设置pagesize
		$showPageMsg(boolean) 是否显示分页信息
		$showPageNoInput(boolean) 是否显示页号输入
*#
#macro(pageTabFoot $paramters)
	#set($page=$paramters.page)
	#set($submitUrl=$!paramters.submitUrl)
	#if($paramters.showPageCount)
		#set($showPageCount = $paramters.showPageCount)##每页显示的分页数
	#else
		#set($showPageCount = 5)##每页显示的分页数
	#end	
	#set($commitMethed = "get")##分页提交方式

	#set($iStartPage = 0)##列表下面显示的分页数开始页
	#set($iEndPage = 0)##列表下面显示的分页数结束页
	#set($iPageNo = $page.pageNo)##当前页
	#set($pageCount = $page.pageCount)##总共页数
	#if("$!paramters.canSetPagesize"!="")
		#set($canSetPagesize=$paramters.canSetPagesize)
	#else
		#set($canSetPagesize=false)
	#end
	#if("$!paramters.showPageMsg"!="")
		#set($showPageMsg=$paramters.showPageMsg)
	#else
		#set($showPageMsg=true)
	#end
	#if("$!paramters.showPageNoInput"!="")
		#set($showPageNoInput=$paramters.showPageNoInput)
	#else
		#set($showPageNoInput=true)
	#end
	#set($queryFormId=$paramters.queryFormId)	

	##分页工具条最中间的页码1	 如果每页显示4个或5个分页码 则为3
	##set($iNoMoveFlag =  ($showPageCount + 1) / 2)
	##分页工具条最中间的页码2     如果每页显示4个或5个分页码 则为2
	##set($iNoMoveFlagEnd =  $showPageCount / 2)

	##剩余页数
	#set($endPageCount=$pageCount - $iPageNo)
	##当前页号小于分页数+1
	#if ($iPageNo <= $showPageCount + 1)
		#set($iStartPage = 1)
		
		#if ($pageCount == $showPageCount+1)      ##等于showPageCount+1
			#set($iEndPage = $showPageCount + 1)
		#elseif ($pageCount > $showPageCount)
			#if($iPageNo > $showPageCount)
				#set($iEndPage = $showPageCount + 3)
			#else
				#set($iEndPage = $showPageCount + 2)			
			#end					
		#else			
			#set($iEndPage = $pageCount)
		#end
	##剩余页数小于分页数
	#elseif($endPageCount <= ($showPageCount - 2))		
		#set($iEndPage = $pageCount)
		#if ($endPageCount > $showPageCount)						
			#set($iStartPage = ${pageCount} - $showPageCount + 1)			
		#else
			#if($endPageCount >= 2)
				#set($iStartPage = $iPageNo - 2)	
				##set($showPageCount = $showPageCount+1)
			#else
				#set($iStartPage = $iPageNo -(4-$endPageCount))		
				##set($showPageCount = $showPageCount)			
			#end
		#end
	#else
		#set($itempLeft = ($showPageCount - 1) / 2)
		#set($itempRight = ($showPageCount ) / 2)
		#set($ipageNumEnd = $iPageNo + $itempRight)
		#if ($pageCount > $ipageNumEnd)
			#set($iStartPage = $iPageNo - $itempLeft)
			#set($iEndPage = $iPageNo + $itempRight)
		#else
			#set($iStartPage = $iPageNo - $itempLeft)
			#set($iEndPage = $pageCount)
		#end
	#end

	#set($pro = $iPageNo - $showPageCount)
	#if($pro < 1)
		#set($pro = 1)
	#end

	#set($next = $iPageNo + $showPageCount)
	#if($next > $pageCount)
		#set($next = $pageCount)
	#end

	#set($leftStart = 1)
    #set($leftEnd = 2)
    #set($rightStart = $pageCount - 1)
    #set($rightEnd = $pageCount)
	
	#if($pageCount!=0)
        ##<div class="pageleft">
			##$!message
		##共找到记录${page.recordCount}个,当前$!{iPageNo}/$!{pageCount}页
		##$action.getText("pageBar.msg","","$page.recordCount","$!{iPageNo}/$!{pageCount}")
		##</div>
		##if($pageCount>1)
			
		#if("$showPageMsg"=="true" || "$canSetPagesize"=="true")<div class="pagebar">#end
			<form class="pageinner" id="pageBarForm_$!{paramters.id}" method="get" #if($submitUrl) action="$submitUrl" #end onsubmit="return pageJump_$!{paramters.id}();">
    			#if("$showPageMsg"=="true" || "$canSetPagesize"=="true")<div class="pageleft">#end   
    				#if("$showPageMsg"=="true")<span>共${page.recordCount}条,${pageCount}页</span>#end
    				#if("$canSetPagesize"=="true") 
    					#set($options = [10,20,30,50,100])
    					<span>每页</span> 
    					<select name="pageSize" onchange="pageJump_$!{paramters.id}(1)">
    						#foreach($o in $options)
    							<option #if("$page.pageSize"=="$o") selected #end value="$o">$o</option>
    						#end
    					</select>
    					<span>条</span>
    				#else
    					<input type="hidden" name="pageSize" value="$page.pageSize"/>
    				#end
				#if("$showPageMsg"=="true" || "$canSetPagesize"=="true")</div>#end   
				<div class="pageright">
                    <div class="pagelink">
                		#if("$iPageNo" != "1")
                			<a href="javascript:pageJump_$!{paramters.id}($page.prePage)" title="上一页" class="pageper">$!{paramters.syy}</a>##
                		#end
                		#if($pro != $iStartPage)
                			#foreach($p in [${leftStart}..${leftEnd}])
                				<a href="javascript:pageJump_$!{paramters.id}($p);">$p</a>##
                			#end
                			##<a href="javascript:pageJump_$!{paramters.id}($!pro)" title="上$showPageCount页">
                            <span>...</span>
                			##</a>
                		#end
                		#foreach($item in [$iStartPage..$iEndPage])
                			#if($item==$iPageNo)
                				<span class="selected">$!item</span>##
                			#else
                				<a href="javascript:pageJump_$!{paramters.id}($!item)" >$!item</a>##
                			#end
                		#end
                		#if($next != $iEndPage)
                			##<a href="javascript:pageJump_$!{paramters.id}($!next)" title="下$showPageCount页">
                			<span>...</span>
                			##</a>
                			##foreach($p in [${rightStart}..${rightEnd}])
                				##<a href="javascript:pageJump_$!{paramters.id}($p);">$p</a>##
                			###end
                		#end
                		#if($iPageNo != ${pageCount})
                			<a href="javascript:pageJump_$!{paramters.id}($page.nextPage)" title="下一页" class="pagenext">$!{paramters.xyy}</a>##
            			#end	
                    </div>
					<input type="hidden" name="pageNo" value="$iPageNo"/>    			
            		#if($page)
						#set($query=$page.query)    					
						#if($query.sort)
        					<input type="hidden" name="sort" value="$!query.sort"/>
    					#end
    					#if($query.sortCode)
        					<input type="hidden" name="sortCode" value="$!query.sortCode"/>
        				#end
						##set($iterator=$page.entrySet().iterator())
    					##set($iterator=$request.getParameterMap().entrySet().iterator())                    	
						##foreach($entry in $iterator)
                    		##if($entry)
            					##if("$!{entry.key}" != "pageNo" && "$!{entry.key}" != "pageSize" && "$!{entry.key}" != "sort" && "$!{entry.key}" != "sortCode" )
            						##<input type="hidden" name="$!{entry.key}" value="$!{entry.value}"/>
            					##end
                    		##end
                    	##end
    				#end
					#if("$showPageNoInput"=="true")
					<div class="pagelink" style="padding-left:7px;">
						到第
						<input type="text" size="3" class="pageno txt_pageno" value="$iPageNo"/>         				
						页
						<input type="submit" value="确定" class="button"/>
                    </div>
					#end
                </div>
            </form>
		#if("$showPageMsg"=="true" || "$canSetPagesize"=="true")</div>#end
		##end
		##$paramters.params
		##set($iterator=$paramters.params.entrySet().iterator())
		##$iterator
        <script language="javascript">				
			var pageBar_$!{paramters.id} = new Core.PageBarForVelocity({
				pageBarFormId:'pageBarForm_$!{paramters.id}',
				queryFormId:'$!queryFormId'
				#if($submitUrl),submitUrl:'$submitUrl' #end
				#*if($paramters.params)
					#set($iterator=$paramters.params.iterator())
					,params:{##
						#foreach($entry in $iterator)
							$!{entry.key}:"$!{entry.value}"##
						#end
					}
				#end*#
			});
			
            function pageJump_$!{paramters.id}(pageno){
            	return pageBar_$!{paramters.id}.changePage($!{pageCount},pageno);
            }
        </script>
	#else
		##<span class="no_data">非常抱歉，没有符合条件的数据！</span>
	#end 
#end

#*
	排序工具栏
	$parameters {Map}
    	$selectName {String}排序选择器的name
    	$sortOptions {Array[{Array]}}排序选项,是一个2为数组
    	 				格式 [['11','按更新时间降序排列'],
        				['12','按更新时间升序排列'],
        				['21','按发布时间降序排列'],
        				['22','按发布时间升序排列']]
    	$currentOption {String}当前排序
    	--$queryFilter {Map}当前的查询条件，用于选择排序时，保留条件
    	$submitAction{String} 提交的action
    	$label 显示在select {String}前得文本
*#
#macro(sortBar $parameters)	
	#set($selectName=$parameters.selectName)
	#set($sortOptions=$parameters.sortOptions)
	#set($submitAction=$parameters.submitAction)
	#set($label=$parameters.label)
	##set($queryFilter=$parameters.queryFilter)
	##set($currentOption=$request.getParameter("$selectName"))
	#set($currentOption=$parameters.currentOption)
	#set($queryFormId=$parameters.queryFormId)	
	<form id="sortBarForm_$selectName" #if($submitAction) action="$submitAction" #end>
    	$!label
		##$sortOptions 
		##$currentOption
    	<select name="$selectName" onchange="sortBar_sort()">
    		#foreach($o in $sortOptions)
    			#set($selected="")
    			#if("$o.get(0)"=="$currentOption")
    				#set($selected="selected")
    			#end

    			<option value="$o.get(0)" $!selected>$o.get(1)</option>
    		#end
    	</select>
    	##if($queryFilter)
            ##set($iterator=$queryFilter.entrySet().iterator())
			##set($iterator=$request.getParameterMap().entrySet().iterator())
        	##foreach($entry in $iterator)
        		##if($entry)
					##if("$!{entry.key}" != "$selectName" && "$!{entry.key}" != "pageNo" && "$!{entry.key}" != "sort"  )
						##<input type="hidden" name="$!{entry.key}" value="$!{entry.value}">
					##end
        		##end
        	##end
		##end
		<script type="text/javascript">
			#if($queryFormId)
				jQuery(function(){				
					setTimeout(function(){
    					var formQuery = jQuery('#$queryFormId');
    					currQuerys = formQuery.formToArray();    				
						var sortBarForm = jQuery('#sortBarForm_$selectName');						
						jQuery.each(currQuerys,function(){
							if(this.value){
								sortBarForm.append('<input type="hidden" name="'+this.name+'" value="'+this.value+'"/>');
							}
						});
					},400);
				});	
			#end
            function sortBar_sort(){
				##Core.UrlUtil.redirectQueryFromForm('$!submitAction','sortBarForm_${selectName}');
            	document.getElementById('sortBarForm_$selectName').submit();
            }
        </script>
    </form>
#end


#*图片上传组件
	 $parameters {Map}包括
	   id {String} 不能带"."
	   name {String} 可为空
	   picBoxSize {String} 图片框宽度
	   imageShow {String} 显示的图片
	   no {Number} 序号
	   fileSizeLimit {Number} 输入最大限制，大为MB，默认5M
*#
#macro(imageUploador $parameters)
	#if("$!parameters.picBoxSize"=="")
		#set($picBoxSize=[128,128])
	#else
		#set($picBoxSize=$parameters.picBoxSize)
	#end

	#if("$!parameters.id"=="")
		#set($id=$parameters.name)
	#else
		#set($id=$parameters.id)
	#end

	#if("$!parameters.name"=="")
		#set($prefix="")
	#else
		#set($prefix=$parameters.name + ".")
	#end
	
	#if($parameters.fileSizeLimit)
		#set($fileSizeLimit=$parameters.fileSizeLimit)
	#else
		#set($fileSizeLimit="5")
	#end	

	<div id="swfupload_${id}" style="float:left;padding:3px;">
		<table cellpadding="0" cellspacing="0" border="0">##
		#if("$!parameters.showBoxSize"=="")
			#set($showBoxSize=$parameters.picBoxSize)
		#else
			#set($showBoxSize=$parameters.showBoxSize)
		#end
		<tr>##
			<td class="thumbnails" style="padding:1px;border:solid 1px #dedede;width:${showBoxSize.get(0)}px;height:${showBoxSize.get(1)}px;text-align: center;" >##
				暂无图片</td>##
		</tr>##
		</table>##
		<div class="fontlink button_box1" style="clear:both;padding-top:5px;padding-left:5px;cursor:pointer">
			<img src="#getComponentUrl()/swfupload/btn_upload.gif" class="bordno img_middle" id="button_upload_${id}" />
		</div>
		<div id="divFileProgressContainer${id}"></div>
		<div class="center fontlink button_box2" style="clear:both;display:none;padding-top:5px;" >
			<div class="fl" >
				<img src="#getComponentUrl()/swfupload/btn_upload_updet.gif" class="bordno img_middle" id="button_reupload_${id}"/>			
            </div>
			<a href="#" class="button_delete ml5">删除</a>
		</div>
		<input type="hidden" name="${prefix}uploadedSubDir" class="uploadedSubDir" />
		<input type="hidden" name="${prefix}originalFileUploadedName" class="originalFileUploadedName" />
		<input type="hidden" name="${prefix}scaleFileUploadedName" class="scaleFileUploadedName" />
		##<input type="hidden" name="${prefix}originalFileUploadedFullPath" class="originalFileUploadedFullPath" />
		#if($parameters.no)
			<input type="hidden" name="${prefix}no" class="no" value="${parameters.no}"/>
		#else
			<input type="hidden" name="${prefix}no" class="no" value="0"/>
		#end
		<input type="hidden" value="false" name="${prefix}delTag" class="delTag" />
		#if($parameters.required)
			<input type="hidden" class="required swfuploadRequiredMsg" name="${id}_imageUploador_v" title="请上传图片"/>
		#end
    </div>	
	#set($uploadActionUrl="#getCurrentSystemUrl('imageUploador-upload')")
	<script type="text/javascript">
		jQuery(function(){
			var swfuploadBox = jQuery("#swfupload_${id}");
			var swfu1,swfu2;			

			var swfuploadConfig = {
				swfuploadBox: swfuploadBox,						
			
				##Backend Settings				
				upload_url:  "$uploadActionUrl",
				post_params: {
					"width": "$!picBoxSize.get(0)",
					"height": "$!picBoxSize.get(1)"
				},
				
				##File Upload Settings
				file_size_limit : "${fileSizeLimit}MB",

				##Button Settings
				button_remove: swfuploadBox.find('.button_delete'),		
				button_image_url : "#getComponentUrl()/swfupload/btn_upload.gif",
				button_placeholder_id : "button_upload_${id}",
				button_width: 70,
				button_height: 20,
				
				##Flash Settings
				flash_url : "#getComponentUrl()/swfupload/swfupload.swf",
				
				//dom元素
				##defaultImage : "#getUploadFileUrl($!{parameters.imageShow})",//默认图片
				defaultImage : "$!{parameters.imageShow}",//默认图片
				upload_target :  "divFileProgressContainer${id}",//进度条容器的id
				thumbnailsBox : swfuploadBox.find('.thumbnails'),//缩率图容器
				uploadButtonsBox : swfuploadBox.find('.button_box1'),//待上传元素容器
				reuploadButtonsBox : swfuploadBox.find('.button_box2'),//已上传元素容器
				swfuploadRequiredMsg : swfuploadBox.find('.swfuploadRequiredMsg'),//"图片必须上传"提示元素
			
				//表单元素
				hidden_uploadedSubDir: swfuploadBox.find('.uploadedSubDir'),//图片上传的子目录
        		hidden_originalFileUploadedName: swfuploadBox.find('.originalFileUploadedName'),//原始图片上传之后的名称        		
        		hidden_delTag: swfuploadBox.find('.delTag')//删除标记				
			}
			swfu1 = new SWFUpload(swfuploadConfig);

			swfuploadConfig.button_image_url = "#getComponentUrl()/swfupload/btn_upload_updet.gif";
			swfuploadConfig.button_placeholder_id = "button_reupload_${id}";
			swfu2 = new SWFUpload(swfuploadConfig);
		});
	</script>
#end

#*
渲染上传的图片
*#
#macro(imageShow $params)
#set($picBoxSize=$params.picBoxSize) 
#set($imagePath=$params.imageUrl)
#set($imageHoverPath=$params.imageHoverPath)
#set($clickUrl=$params.clickUrl)
#set($target=$params.target)
#set($imageSizeEqualsBoxSize=$params.imageSizeEqualsBoxSize) 
#if(!$imageSizeEqualsBoxSize)
	#set($imageSizeEqualsBoxSize="true")
#end
#if(!$target)
	#set($target="_blank")
#end
<table cellpadding="0" cellspacing="0" border="0"><tr>##
<td style="padding:0px;background-color:#f7f7f7;border:solid 1px #dedede;width:${picBoxSize.get(0)}px;height:${picBoxSize.get(1)}px" align="center">##
#if("$!imagePath" == "")
	暂无图片
#else
#if("$!clickUrl" != "")<a href="$!clickUrl" target="$!target">#end##
<img src="#getUploadFileUrl($!imagePath)" #if("$imageSizeEqualsBoxSize"=="true") width="${picBoxSize.get(0)}px" height="${picBoxSize.get(1)}px" #end />##
#if("$!clickUrl" != "")</a>#end##
#end
</td></tr></table>
#end

#*
图片渲染，不带框
*#
#macro(imageSimpleShow $params)
	#set($imageUrl=$params.imageUrl)
	#set($imageWidth=$params.imageWidth)
	#set($imageHeight=$params.imageHeight)
	#set($imageClass=$params.imageClass)
	#set($noImageUrl=$params.noImageUrl)

    #if($imageUrl)
    	#set($src="#getUploadFileUrl($!imageUrl)")
    #else
		#if($noImageUrl)
			#set($src=$noImageUrl)
		#else
			#set($src="#getWebresourcesUrl()/images/no_picture.gif")			
		#end
	#end
	<img src="$src" #if($imageWidth) width="${imageWidth}" #end  #if($imageHeight) height="${imageHeight}" #end  #if($imageClass) class="$imageClass" #end/>##
#end

#*
     渲染 联动 select标签
  	formSelects {Array<Map>}
	    Map值：
          id {String}select 标签的id,默认等于name
          name  {String} select 标签的name,必须
          firstOption {Array} 为select加上第一个选项 ,数据格式：[value,text]
          selectedValue {String}选择值
		  attributs {String} 附加属性   格式："style='width:100px' class='select'"

	$parameters {Map}包括
		{"id":"regionSelect","getDataUrl":"getDictionaryByGroupAndParentValue$!context_wsUrlSuffix","getDataParams":"dictGroup:'regionCode'"})
*#
#macro(formSelectLinked $formSelects $parameters)
	#set($id=$parameters.id)

	<span id="formSelectLinked_${id}">
	#foreach($formSelect in $formSelects )
		#if($formSelect.firstOption)
    		#set($firstOption="<option value='$formSelect.firstOption.get(0)'>$formSelect.firstOption.get(1)</option>")
    	#else
    		#set($firstOption="")
		#end

		#set($selectid="$!formSelect.id")
    	#if("$selectid"=="")
    		#set($selectid=$formSelect.name)
    	#end

		<select name="$formSelect.name" id="$selectid" $!{formSelect.attributs}>
			#direct($firstOption)
		</select>
	#end
	</span>

	<script type="text/javascript">
		jQuery(function(){
			##select集合
    		var selects = jQuery('select',jQuery('#formSelectLinked_${id}'));
    		##alert(selects.size());

    		##选中值数组
			var selectedValues = [#foreach($formSelect in $formSelects )#if($velocityCount > 1),#end '$!formSelect.selectedValue'#end];
			##首选项数组
			var firstOptions = [#foreach($formSelect in $formSelects )#if($velocityCount > 1),#end '<option value="$formSelect.firstOption.get(0)">$formSelect.firstOption.get(1)</option>'#end];

    		##jQuery(function(){##加载第一个select的options
    			jQuery.post(
    				'#getAppServer()/${parameters.getDataUrl}',
    				{$!parameters.getDataParams,'parentValue':''},
    			    function(responseText, textStatus){
    					if(jQuery.trim(responseText) != ''){
    						jQuery(selects.get(0)).append(responseText);

    						if(jQuery.trim(selectedValues[0])!=''){##选中的值
								setTimeout(function() {
									jQuery(selects.get(0)).val(selectedValues[0]);##定位
								});
    							appendChildSelect(1);##加载下属select的options
    						}
    					}
    				}
    			);
    		##});

    		selects.each(function(i){##为每个select除最后一个,附加change事件
    			if(i < selects.length - 1){ ##去掉最后一个
    				var selectNext = selects.get(i+1); ##下一个
    				jQuery(this).change(function(){
    					selects.each(function(j){ ## 将触发事件的select后面的select全部清空
    						if(j > i){
    							jQuery(this).empty().append(firstOptions[j]);
    						}
    					})
    					if(this.value != ''){
    						jQuery.post(
    							'#getAppServer()/${parameters.getDataUrl}',
    							{$!parameters.getDataParams,'parentValue':this.value},
    						    function(responseText, textStatus){
    								if(jQuery.trim(responseText) != ''){
    						    		jQuery(selectNext).append(responseText);
    								}
    							}
    						);
    					}
    				})
    			}
    		});

    		##加载下属select的options,递归
			function appendChildSelect(i){
    			var select = selects.get(i);
    			var parentValue = selectedValues[i-1];
    			var thisValue = selectedValues[i];
    			jQuery.post(
    				'#getAppServer()/${parameters.getDataUrl}',
    				{$!parameters.getDataParams,'parentValue':parentValue},
    			    function(responseText, textStatus){
    					if(jQuery.trim(responseText) != ''){
    			    		jQuery(select).append(responseText);
							if(jQuery.trim(thisValue)!=''){##选中的值
								setTimeout(function() {
    								jQuery(select).val(thisValue);
								});
    							if(i < selectedValues.length - 1){##除去最后一个
        							appendChildSelect(i+1);
    							}
							}
    					}
    				}
    			);
    		}
		});
	</script>
#end

#*
	验证码
	$parameters{Map}
		name {String} 验证码input的id和name

*#
#macro(validateCode $parameters)
	<input name="$parameters.name" type="text" size="10" class="required $!parameters.cls" id="$parameters.name" />
	<img src="#getAppServer()$!context_wsServerPrefix/validateCode$!context_wsUrlSuffix" id="img_$parameters.name"/>
	<span>看不清楚，<a href="#" id="link_$parameters.name" >换一张图片</a></span>
	<script type="text/javascript">
        jQuery(function() {
			jQuery('#$parameters.name').rules('add',{
				remote: {
				    url: '#getAppServer()$!context_wsServerPrefix/validateCode-check$!context_wsUrlSuffix',
				    type: "post"
				    ##,dataType: "json"
				},
				messages:{remote: '校验码不正确'}
			});


			jQuery('#link_$parameters.name').click(function(){
            	var img = document.getElementById("img_$parameters.name");
            	var timenow = new Date().getTime();
            	  ##每次请求需要一个不同的参数，否则可能会返回同样的验证码
            	  ##这和浏览器的缓存机制有关系，也可以把页面设置为不缓存，这样就不用这个参数了。
            	img.src= "#getAppServer()$!context_wsServerPrefix/validateCode$!context_wsUrlSuffix?d=" + timenow;
				return false;
            });
		});

    </script>
#end

#*直接输出html*#
#macro (direct $direct-output )#if($direct-output) $direct-output #end#end
	
#*加载基本的前端资源*#
#macro(loadBaseWebResources)		
	#if($appContextTool.isDebug())			
		<script type="text/javascript" src="#getComponentUrl()/jquery/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/jquery/form/jquery.form.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/jquery/boxy/javascripts/jquery.boxy.js"></script>	
		<script type="text/javascript" src="#getComponentUrl()/jquery/jquery-validate/jquery.validate.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/jquery/jquery-validate/lib/jquery.metadata.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/jquery/jquery-validate/localization/messages_cn.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/ancun/core.js"></script>
		<script type="text/javascript" src="#getComponentUrl()/ancun/core.validate.js"></script>
		<link href="#getWebresourcesUrl()/css/global.css" rel="stylesheet" type="text/css" />	
	#end
#end

##加载表单验证客户端资源
#macro(loadFormWebResources)
#end

##加载日历客户端资源
#macro(loadDatePickerWebResources)
	<script src='#getComponentUrl()/My97DatePicker/4.8/WdatePicker.js' type='text/javascript'></script>
#end

##加载HtmlEditor验证客户端资源
#macro(loadHtmlEditorWebResources)	
	<script src='#getComponentUrl()/kindeditor/4.0.5/kindeditor.js' type='text/javascript'></script>
	<script src='#getComponentUrl()/kindeditor/4.0.5/lang/zh_CN.js' type='text/javascript'></script>
#end

##加载swf图片上传器客户端资源
#macro(loadImageUploadorWebResources)
	<script src='#getComponentUrl()/swfupload/swfupload.js' type='text/javascript'></script>
	<script src='#getComponentUrl()/swfupload/uploadedHandlers.js' type='text/javascript'></script>
	##<script src='#getComponentUrl()/swfupload/swfupload.debug.js' type='text/javascript'></script>
	##<script src='#getComponentUrl()/swfupload/uploadedHandlers.debug.js' type='text/javascript'></script>
	##<link href='#getComponentUrl()/swfupload/default.css' rel='stylesheet' type='text/css'/>
#end

##加载列表客户端资源
#macro(loadListWebResources)
	#if($appContextTool.isDebug())
		<script type='text/javascript' src='#getComponentUrl()/ancun/core.list.js'></script>
	#end
#end

#macro(loadExtJsWebResources)
	#if($appContextTool.isDebug())
		#set($resSubUrl="/debug")
		#set($resSubUrl2="-debug")
	#end
	<link rel="stylesheet" type="text/css" href="#getComponentUrl()/ext/ext-3.2.0/resources/css/ext-all.css" />		
	<script type="text/javascript"	src="#getComponentUrl()/ext/ext-3.2.0/adapter/ext/ext-base.js"></script>
	<script type="text/javascript" src="#getComponentUrl()/ext/ext-3.2.0/ext-all$!{resSubUrl2}.js"></script>	
	<script type="text/javascript" src="#getComponentUrl()/ancun/core.ext3.js"></script>
	<script type="text/javascript">
		Ext.BLANK_IMAGE_URL = '#getComponentUrl()/ext/ext-3.2.0/resources/images/default/s.gif';
    </script>
	##	
	##<link rel="stylesheet" type="text/css" href="#getComponentUrl()/ext/ext-4.0.7-gpl/resources/css/ext-all.css" />
    ##<script type="text/javascript" src="#getComponentUrl()/ext/ext-4.0.7-gpl/bootstrap.js"></script>
	##<script type="text/javascript" src="#getComponentUrl()/ext/ext-4.0.7-gpl/ext-all.js"></script>    	
	##<script type="text/javascript" src="#getComponentUrl()/evan/evan.ext4.js"></script>
#end

#macro(loadDateJsWebResources)
	<script src='#getComponentUrl()/datejs/date-zh-CN.js' type='text/javascript'></script>
#end

#*
	加载指定的前端资源
	keys 是一个String[] 支持的值包括:
	datePicker
	form
	htmlEditor
	imageUploador
	list
	extJs
	
	比如要加载表单和日历， 则 #loadWebResources(['datePicker','form'])
*#
#macro(loadWebResources $keys)
	#if(!$screen_isLoadWebResources)
		#set($screen_isLoadWebResources={})
	#end	
	#foreach($key in $keys)
		$!screen_isLoadWebResources.put("$key",true)
	#end
#end

#macro(renderTitleAndMetas $title)
	<title>#if($screen_title) $screen_title  #end #if($screen_noDefaultTitle) #else - $!title #end</title>
	<meta http-equiv="Content-Type" content="text/html; charset=$appContextTool.getWebEncoding()" />
	#if($screen_metaArray)
    	#foreach($meta in $!screen_metaArray)
    		<meta name="$!meta.name" content="$!meta.content" />
    	#end
	#end
#end

##公用的head
#macro(htmlHeador $title)	
	#renderTitleAndMetas()	
	#loadBaseWebResources()		
#end

##20141118 xyy 加载其他web资源
#macro(loadOtherWebResources)
	##if($screen_isLoadWebResources.form) #loadFormWebResources() #end
	#if($screen_isLoadWebResources.dateJs) #loadDateJsWebResources() #end
	#if($screen_isLoadWebResources.datePicker) #loadDatePickerWebResources() #end
	#if($screen_isLoadWebResources.htmlEditor) #loadHtmlEditorWebResources() #end	
	#if($screen_isLoadWebResources.imageUploador) #loadImageUploadorWebResources() #end	
	#if($screen_isLoadWebResources.list) #loadListWebResources() #end			
#end

#*
	加载本应用的js
*#
#macro(loadAppRes $prefix)
	#if($screen_isLoadWebResources.dateJs) #loadDateJsWebResources() #end
	#if($screen_isLoadWebResources.datePicker) #loadDatePickerWebResources() #end
	#if($screen_isLoadWebResources.htmlEditor) #loadHtmlEditorWebResources() #end	
	#if($screen_isLoadWebResources.imageUploador) #loadImageUploadorWebResources() #end	
	#if($screen_isLoadWebResources.list) #loadListWebResources() #end	
	#if($screen_isLoadWebResources.extJs) #loadExtJsWebResources() #end	

	#*if($context_urlPrefixMap)
		<script type="text/javascript">
			#foreach($entry in $!context_urlPrefixMap.entrySet())
				App.systemPrefixs.${entry.key} = '/$entry.value';		
			#end
		</script>
	#end*#

    #foreach($f in $!screen_jsArray)##
		#if($stringUtil.startsWith($f,"http"))##
			<script src="${f}.js" type="text/javascript"></script>
		#else##
			<script src="#getJsPath()$!{prefix}/${f}.js" type="text/javascript"></script>
		#end##
	#end
#end

#macro(msg $page_msg)
    <div class="common_msg3">
    	<span class="icons icons_$page_msg.type"></span>
		<span class="text">
    		<div class="msgtitle msgtitle_$page_msg.type"> #direct($page_msg.title)</div>
        	<ul>
        		#foreach($c in $page_msg.contents)
        			<li>
        				#direct($c)
                    </li>
        		#end
        	</ul>
		</span>
    	#if("$page_msg.type"!="success" && "$!page_msg.hiddenBack" != "true")
            ##<div class="clear"></div>
    		<div class="buttonbox">
    			<input type="button" value="返 回" onclick="history.back()"/>
    		</div>
    	#end
    </div>
#end

##年度select
#macro(yearSelect $params)
	#if($params.selectedYear)
		#set($selectedYear=$params.selectedYear)
	#else
		#set($selectedYear=$date.getYear())
	#end
	
	<select id="$!{params.name}year" name="$!{params.name}year">
		#set($years=[2012..$math.add($date.getYear(),1)])
		#foreach($year in $years)
		<option value="$year" #if("$!selectedYear"=="$!{year}") selected #end>${year}</option>
		#end
	</select> 
#end

##月份select
#macro(monthSelect $params)
	#if($params.selectedMonth)
		#set($selectedMonth=$params.selectedMonth)
	#else
		#set($selectedMonth=$math.add($date.getMonth(),1))
	#end	
	
	<select id="$!{params.name}month" name="$!{params.name}month">
		#set($months=[1..12])
		#foreach($month in $months)
		<option value="$month" #if("$!selectedMonth"=="$!{month}") selected #end>${month}</option>
		#end		
	</select> 
#end

##季度select
#macro(quarterSelect $params)
	#if($params.selectedQuarter)
		#set($selectedQuarter=$params.selectedQuarter)
	#else
		#set($selectedQuarter=$math.add($date.getQuarter(),1))
	#end	
	
	<select id="$!{params.name}quarter" name="$!{params.name}quarter">
		#set($quarters=[1..4])
		#foreach($quarter in $quarters)
		<option value="$quarter" #if("$!selectedQuarter"=="$!{quarter}") selected #end>${quarter}</option>
		#end		
	</select> 
#end

#macro(searchItemFromTo $formboxId $toboxId )
	<span id="$formboxId" style="float:left;"></span>
    <span style="float:left;padding:0 3;">-</span>
	<span id="$toboxId" style="float:left;"></span>
#end

#macro(searchItems $items )
	#foreach($item in $items)
		<span id="$item" style="float:left;padding-left:8px;"></span>
	#end
#end

#macro(scriptCode)
    #if("$!scriptCode" != "")
    <script type="text/javascript">
    	$scriptCode
    </script>
    #end
#end

#macro(csrfToken $params)
	#if($params.name)
		#set($tokenInputName=$params.name)
	#else
		#set($tokenInputName="ancun_token")
	#end
	#set($tokenKeyAndValue=$csrfTokenTool.getToken($request,$response))
	<input name="$tokenKeyAndValue.get(0)" type="hidden" value="$tokenKeyAndValue.get(1)">
#end

